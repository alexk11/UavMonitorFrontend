<!--theme-toggle /-->
<div class="header-container">
    <h3 class="page-title">Список БВС</h3>
</div>

<app-info-dialog
        [message]="message"
        [display]="dialogVisible"
        (confirm)="dialogVisible=false">
</app-info-dialog>

<div class="search-container">
    <p-dropdown
            [options]="vehicleTypes"
            [(ngModel)]="selectedType"
            (onChange)="applyTypeFilter()"
            placeholder="Выберите тип"
            optionLabel="label"
            optionValue="value"
            [showClear]="false"
            styleClass="type-dropdown">
    </p-dropdown>
    <p-iconfield iconPosition="left">
        <p-inputicon>
            <i class="pi pi-search"></i>
        </p-inputicon>
        <input
                pInputText type="text"
                (input)="applyFilter($event)"
                (keyup)="applyFilter($event)"
                placeholder="Поиск в таблице"/>
    </p-iconfield>
    <div class="actions-container">
        <button class="action-button add-button"
                title="Добавить новый БВС"
                (click)="addVehicle()">
            <i class="pi pi-plus"></i> Добавить
        </button>
        <button class="action-button delete-button"
                title="Удалить выбранные БВС"
                (click)="onDelete()"
                [disabled]="selectedVehicles.length == 0">
            <i class="pi pi-trash"></i> Удалить
        </button>
    </div>
</div>

<div class="card">
    <p-table
            [columns]="cols"
            [value]="displayedVehicles"
            showGridlines
            stripedRows
            [paginator]="true"
            [rows]="rows"
            [first]="first"
            [(selection)]="selectedVehicles"
            [showCurrentPageReport]="true"
            [tableStyle]="{ 'min-width': '50rem' }"
            currentPageReportTemplate="Показаны {first}-{last} из {totalRecords} записей"
            (onPage)="pageChange($event)">
        <ng-template #header let-columns>
            <tr>
                <th pSortableColumn="id" style="width:10%">
                    <div class="flex items-center gap-2">
                        {{ cols.at(0)?.header }}
                        <p-sortIcon field="id"/>
                    </div>
                </th>
                <th pSortableColumn="type" style="width:20%">
                    <div class="flex items-center gap-2">
                        {{ cols.at(1)?.header }}
                        <p-sortIcon field="type"/>
                    </div>
                </th>
                <th pSortableColumn="vehicleId" style="width:20%">
                    <div class="flex items-center gap-2">
                        {{ cols.at(2)?.header }}
                        <p-sortIcon field="vehicleId"/>
                    </div>
                </th>
                <th pSortableColumn="description" style="width:40%">
                    <div class="flex items-center gap-2">
                        {{ cols.at(3)?.header }}
                        <p-sortIcon field="description"/>
                    </div>
                </th>
                <th style="width:10%">
                    <div style="text-align: center">Выбрать</div>
                </th>
            </tr>
        </ng-template>
        <ng-template #body let-vehicle>
            <tr (dblclick)="onUavRowDoubleClick(vehicle)" class="clickable-row">
                <td>
                    <p-cellEditor>
                        <ng-template #input>
                            {{ vehicle.id }}
                        </ng-template>
                        <ng-template #output>
                            {{ vehicle.id }}
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <p-cellEditor>
                        <ng-template #input>
                            {{ vehicle.type }}
                        </ng-template>
                        <ng-template #output>
                            {{ vehicle.type }}
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td>
                    <p-cellEditor>
                        <ng-template #input>
                            {{ vehicle.vehicleId }}
                        </ng-template>
                        <ng-template #output>
                            {{ vehicle.vehicleId }}
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td pEditableColumn>
                    <p-cellEditor (click)="onUavRowClick(vehicle)">
                        <ng-template #input>
                            <!--input
                                pInputText
                                type="text"
                                [(ngModel)]="vehicle.description"
                                (blur)="onDescriptionEdit(vehicle)"
                                class="editable-input" /-->
                            <textarea pTextarea
                                      rows="3" cols="40"
                                      (clickOutside)="editMode = false"
                                      (blur)="onDescriptionEdit(vehicle)"
                                      [(ngModel)]="vehicle.description">
                        </textarea>
                        </ng-template>
                        <ng-template *ngIf="!editMode" #output>
                        <span class="editable-field" title="Нажмите для редактирования">
                            {{ vehicle.description }}
                        </span>
                        </ng-template>
                    </p-cellEditor>
                </td>
                <td style="text-align: center">
                    <p-tableCheckbox [value]="vehicle"/>
                </td>
            </tr>
        </ng-template>
        <ng-template #emptymessage>
            <tr>
                <td colspan="5" style="text-align: center; padding: 40px; color: #666;">
                    <i class="pi pi-inbox" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                    <p>Нет данных для отображения</p>
                </td>
            </tr>
        </ng-template>
    </p-table>
    <p class="table-hint">
        * Нажмите дважды на строку в таблице для просмотра или редактирования профиля БВС. Нажмите на поле "Описание"
        для быстрого редактирования.
    </p>
</div>
